((function(){var a;$(function(){return a.init()}),a={tail_logs_url:null,tail_log_started:!1,log_info_offset:null,log_info_padding:15,init:function(){var b=this;return $(document).ajaxStart(function(){return $("#ajax_loader").show()}),$(document).ajaxStop(function(){return $("#ajax_loader").hide()}),$(document).on("click","#tail_logs_link",function(b){return a.tail_logs_url=$(b.target).attr("data-url"),$("#tail_logs_block").addClass("started"),a.tail_logs(null),!1}),$(document).on("click","#tail_logs_stop_link",function(b){return a.tail_log_started=!1,$("#tail_logs_block").removeClass("started"),!1}),$(document).on("click",".log_info",function(a){var b,c;return b=$(a.target),c=b.data("url"),c==null&&(c=b.parent("tr").data("url")),c!=null&&(b.parents("table").find("tr").removeClass("current"),b.parent("tr").addClass("current"),$("#log_info").load(c)),!1}),$(document).on("click","div.filter-toggle",function(a){return $("div.filter").slideToggle(),$("div.filter-toggle span.arrow-down").toggleClass("rotate")}),$(document).on("click","#add_more_filter",function(a){var b;return b=$(a.target).attr("href"),$.ajax({url:b,success:function(a){var b;return b=$("<li></li>").html(a),$("#more_filter_list").append(b)}}),!1}),$(document).on("change","select.filter_type",function(a){var b,c;return b=$(a.target),c=b.attr("rel")+"/"+b.val(),$.ajax({url:c,dataType:"json",success:function(a){var c,d,e=this;c="",d="",$.each(a.conditions,function(a,b){return c+='<option value="'+b+'">'+b+"</option>"}),b.parents("div.filter_block").find("select.filter_conditions").empty().append(c),a.values.length>0?(d='<select id="filter[more][]_value" name="filter[more][][value]">',$.each(a.values,function(a,b){return d+='<option value="'+b+'">'+b+"</option>"}),d+="</select>"):d='<input type="text" name="filter[more][][value]" value="" placeholder="value">',b.parents("div.filter_block").find("div.filter_values").html(d);if("date"===b.val())return b.parents("div.filter_block").find("div.filter_values input").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"c-50:c+10"})}}),!1}),$(document).on("click",".close_more_filter",function(a){return $(a.target).parents("li").remove(),!1}),$(document).on("click","li.message_tab",function(a){var b,c;b=$(a.target),c=b.attr("data-tab");if(c!=null)return $("li.message_tab").removeClass("active"),$("pre.tab_content").addClass("hidden"),b.addClass("active"),$("."+c).removeClass("hidden")}),$(document).on("submit","#analyticForm",function(a){var b,c,d;return c=$("#analyticForm"),d=c.attr("action"),b=c.serializeArray(),$("#analyticData").load(d,b),!1}),$(document).on("keydown","*",function(b){console.log(b.keyCode);switch(b.keyCode){case 37:return a.move_by_logs("begin");case 38:return a.move_by_logs("up");case 39:return a.move_by_logs("end");case 40:return a.move_by_logs("down")}}),this.init_pjax(),this.init_on_pages()},init_pjax:function(){var b=this;return $("a[data-pjax]").pjax(),$("body").bind("pjax:start",function(){return $("#ajax_loader").show()}),$("body").bind("pjax:end",function(){return $("#ajax_loader").hide(),a.tail_log_started=!1,$(window).scrollTop()>100&&$("html, body").stop().animate({scrollTop:0},"slow"),a.init_on_pages()})},init_on_pages:function(){var b=this;$("pre code").each(function(a,b){return hljs.highlightBlock(b,"  ")}),$(".datepicker, .filter_values input.date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"c-50:c+10"});if($("#log_info").length>0)return a.log_info_offset=$("#log_info").offset(),$(window).scroll(function(){return $(window).scrollTop()>a.log_info_offset.top?$("#log_info").stop().animate({marginTop:$(window).scrollTop()-a.log_info_offset.top+a.log_info_padding}):$("#log_info").stop().animate({marginTop:0})})},tail_logs:function(b){var c;c=a.tail_logs_url,b!=null&&b.length>0?c=a.tail_logs_url+"/"+b:(a.tail_log_started=!0,b="");if(a.tail_log_started)return $.ajax({url:c,dataType:"json",success:function(c){var d,e;c.time&&($("#tail_logs_time").text(c.time),c.log_last_id!=null&&(b=c.log_last_id),c.content!=null&&c.content.length>0&&(d=$(c.content),d.addClass("newlog"),$("#logs_list tr:first").after(d).effect("highlight",{},1e3)),c.collection_stats&&$("#collection_stats").length>0&&$("#collection_stats").html(c.collection_stats));if(a.tail_log_started)return e=function(){return a.tail_logs(b)},setTimeout(e,2e3)}})},move_by_logs:function(b){var c,d;if($("#logs_list").length>0&&$("#logs_list").find("tr.current").length>0){c=$("#logs_list").find("tr.current");switch(b){case"begin":d=$("#logs_list tr:first").next("tr");if(d.length>0)return d.find("td:first").trigger("click"),$(window).scrollTop(d.height()+d.offset().top-100),!1;break;case"end":d=$("#logs_list tr:last");if(d.length>0)return d.find("td:first").trigger("click"),$(window).scrollTop(d.height()+d.offset().top-100),!1;break;case"down":d=c.next("tr");if(d.length>0)return d.find("td:first").trigger("click"),a.is_scrolled_into_view(d)?$(window).scrollTop($(window).scrollTop()+d.height()):$(window).scrollTop(d.height()+d.offset().top-100),!1;break;case"up":d=c.prev("tr");if(d.length>0)return d.find("td:first").trigger("click"),a.is_scrolled_into_view(d)?$(window).scrollTop($(window).scrollTop()-d.height()):$(window).scrollTop(d.height()+d.offset().top-100),!1}}},is_scrolled_into_view:function(a){var b,c,d,e;return c=$(window).scrollTop(),b=c+$(window).height(),e=$(a).offset().top,d=e+$(a).height(),c<e&&b>d}}})).call(this)
